{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/qnguyen77/Desktop/reactjs/study-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/qnguyen77/Desktop/reactjs/study-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"C:/Users/qnguyen77/Desktop/reactjs/study-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:/Users/qnguyen77/Desktop/reactjs/study-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{useLocation}from\"react-router\";import NavigateQuickly from\"./../../component/NavigateQuickly/NavigateQuickly\";import Header from\"./../../component/Header/Header\";import CardProduct from\"./../../component/CardProduct/CardProduct\";import Pagination from\"./../../component/Pagination/Pagination\";import{useSelector}from\"react-redux\";import\"./ResultSearch.scss\";import Loading from\"../../component/Loading/Loading\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ResultSearch(){var ITEM_PECENT_PAGE=20;var _useLocation=useLocation(),_useLocation$state=_useLocation.state;_useLocation$state=_useLocation$state===void 0?{}:_useLocation$state;var _useLocation$state$en=_useLocation$state.enter,enter=_useLocation$state$en===void 0?\"\":_useLocation$state$en,_useLocation$state$fi=_useLocation$state.fillter,fillter=_useLocation$state$fi===void 0?\"\":_useLocation$state$fi;var categories=useSelector(function(category){return category.categories.categories;});var _useState=useState([]),_useState2=_slicedToArray(_useState,2),productFilter=_useState2[0],setProductFilter=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),productFilterPagination=_useState4[0],setProductFilterPagination=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoading=_useState6[0],setIsLoading=_useState6[1];var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),currentPage=_useState8[0],setCurrentPage=_useState8[1];useEffect(function(){setIsLoading(true);var listId=getAllCategorySelected(fillter,categories);var listDataSource=[];setCurrentPage(1);if(fillter===\"ALL\"){try{getProductList(fillter).then(function(result){if(enter){result.forEach(function(item){if(item.productName.includes(enter)){listDataSource.push(item);}});}else{listDataSource.push.apply(listDataSource,_toConsumableArray(result));}setProductFilter([].concat(listDataSource));setProductFilterPagination(listDataSource.splice(0,ITEM_PECENT_PAGE));setIsLoading(false);});}catch(error){console.log(\"call api fail\",error);}}else{try{Promise.all(listId.map(function(id){return getProductList(id).then(function(item){var arrayFilter=[];item.forEach(function(itemFilter){if(itemFilter.productName.includes(enter)){arrayFilter.push(itemFilter);}});return arrayFilter;});})).then(function(result){result.forEach(function(item){listDataSource.push.apply(listDataSource,_toConsumableArray(item));});setProductFilter([].concat(listDataSource));setProductFilterPagination(listDataSource.splice(0,ITEM_PECENT_PAGE));setIsLoading(false);});}catch(error){console.log(\"call api fail\",error);}}},[enter,fillter,categories]);function getProductListByPagination(pagination){var currentPage=pagination.currentPage;var start=currentPage*ITEM_PECENT_PAGE-ITEM_PECENT_PAGE||0;var end=ITEM_PECENT_PAGE;var listMap=_toConsumableArray(productFilter);setProductFilterPagination(_toConsumableArray(listMap.splice(start,end)));}return/*#__PURE__*/_jsxs(\"div\",{className:\"ResultSearch\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"NavigateQuickly\",children:/*#__PURE__*/_jsx(NavigateQuickly,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"Header\",children:/*#__PURE__*/_jsx(Header,{title:\"S\\u1EA3n ph\\u1EA9m\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"BodySearch\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"ProductList\",children:isLoading?/*#__PURE__*/_jsx(Loading,{isLoading:isLoading}):productFilterPagination.length===0?/*#__PURE__*/_jsx(\"div\",{children:\"Kh\\xF4ng t\\xECm th\\u1EA5t k\\u1EBFt qu\\u1EA3.\"}):productFilterPagination.map(function(product,index){return/*#__PURE__*/_jsx(CardProduct,{itemProduct:product},index);})}),productFilterPagination.length!==0&&/*#__PURE__*/_jsx(\"div\",{className:\"Pagination\",children:/*#__PURE__*/_jsx(Pagination,{pageChangeClick:getProductListByPagination,itemPage:ITEM_PECENT_PAGE,totalItem:productFilter.length,currentPage:currentPage})})]})]});}var getAllCategorySelected=function getAllCategorySelected(categoriId,categories){var category=categories.find(function(item){return item.id===categoriId;});var arrayIdCategory=[];if(category){category.subCategory.forEach(function(item){var itemMap=item.subCategory.map(function(itemMap){return itemMap.id;});arrayIdCategory.push.apply(arrayIdCategory,_toConsumableArray(itemMap));});}return arrayIdCategory;};var getProductList=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(categoryId){var uri,headers,url,response,responseJson;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:uri=\"https://api-json-server-290621.herokuapp.com/api/products\";headers={headers:{\"Content-Type\":\"application/json\",Accept:\"application/json\"}};url=categoryId!==\"ALL\"?\"\".concat(uri,\"?categoryId=\").concat(categoryId):uri;_context.next=5;return fetch(url,headers);case 5:response=_context.sent;_context.next=8;return response.json();case 8:responseJson=_context.sent;return _context.abrupt(\"return\",responseJson);case 10:case\"end\":return _context.stop();}}},_callee);}));return function getProductList(_x){return _ref.apply(this,arguments);};}();export default ResultSearch;","map":{"version":3,"sources":["C:/Users/qnguyen77/Desktop/reactjs/study-react/src/screens/ResultSearch/ResultSearch.jsx"],"names":["React","useState","useEffect","useLocation","NavigateQuickly","Header","CardProduct","Pagination","useSelector","Loading","ResultSearch","ITEM_PECENT_PAGE","state","enter","fillter","categories","category","productFilter","setProductFilter","productFilterPagination","setProductFilterPagination","isLoading","setIsLoading","currentPage","setCurrentPage","listId","getAllCategorySelected","listDataSource","getProductList","then","result","forEach","item","productName","includes","push","splice","error","console","log","Promise","all","map","id","arrayFilter","itemFilter","getProductListByPagination","pagination","start","end","listMap","length","product","index","categoriId","find","arrayIdCategory","subCategory","itemMap","categoryId","uri","headers","Accept","url","fetch","response","json","responseJson"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router\";\r\nimport NavigateQuickly from \"./../../component/NavigateQuickly/NavigateQuickly\";\r\nimport Header from \"./../../component/Header/Header\";\r\nimport CardProduct from \"./../../component/CardProduct/CardProduct\";\r\nimport Pagination from \"./../../component/Pagination/Pagination\";\r\nimport { useSelector } from \"react-redux\";\r\nimport \"./ResultSearch.scss\";\r\nimport Loading from \"../../component/Loading/Loading\";\r\n\r\nfunction ResultSearch() {\r\n  const ITEM_PECENT_PAGE = 20;\r\n  const { state: { enter = \"\", fillter = \"\" } = {} } = useLocation();\r\n  const categories = useSelector((category) => category.categories.categories);\r\n  const [productFilter, setProductFilter] = useState([]);\r\n  const [productFilterPagination, setProductFilterPagination] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  useEffect(() => {\r\n    setIsLoading(true);\r\n    const listId = getAllCategorySelected(fillter, categories);\r\n    const listDataSource = [];\r\n    setCurrentPage(1);\r\n    if (fillter === \"ALL\") {\r\n      try {\r\n        getProductList(fillter).then((result) => {\r\n          if (enter) {\r\n            result.forEach((item) => {\r\n              if (item.productName.includes(enter)) {\r\n                listDataSource.push(item);\r\n              }\r\n            });\r\n          } else {\r\n            listDataSource.push(...result);\r\n          }\r\n\r\n          setProductFilter([...listDataSource]);\r\n          setProductFilterPagination(\r\n            listDataSource.splice(0, ITEM_PECENT_PAGE)\r\n          );\r\n          setIsLoading(false);\r\n        });\r\n      } catch (error) {\r\n         console.log(\"call api fail\", error);\r\n      }\r\n      \r\n    } else {\r\n      try {\r\n          Promise.all(\r\n            listId.map((id) => {\r\n              return getProductList(id).then((item) => {\r\n                const arrayFilter = [];\r\n                item.forEach((itemFilter) => {\r\n                  if (itemFilter.productName.includes(enter)) {\r\n                    arrayFilter.push(itemFilter);\r\n                  }\r\n                });\r\n                return arrayFilter;\r\n              });\r\n            })\r\n          ).then((result) => {\r\n            result.forEach((item) => {\r\n              listDataSource.push(...item);\r\n            });\r\n            setProductFilter([...listDataSource]);\r\n            setProductFilterPagination(\r\n              listDataSource.splice(0, ITEM_PECENT_PAGE)\r\n            );\r\n            setIsLoading(false);\r\n          });\r\n      } catch (error) {\r\n        console.log(\"call api fail\", error);\r\n      }\r\n      \r\n    }\r\n  }, [enter, fillter, categories]);\r\n\r\n  function getProductListByPagination(pagination) {\r\n    const { currentPage } = pagination;\r\n    const start = currentPage * ITEM_PECENT_PAGE - ITEM_PECENT_PAGE || 0;\r\n    const end = ITEM_PECENT_PAGE;\r\n    const listMap = [...productFilter];\r\n    setProductFilterPagination([...listMap.splice(start, end)]);\r\n  }\r\n  return (\r\n    <div className=\"ResultSearch\">\r\n      <div className=\"NavigateQuickly\">\r\n        <NavigateQuickly />\r\n      </div>\r\n      <div className=\"Header\">\r\n        <Header title=\"Sản phẩm\" />\r\n      </div>\r\n      <div className=\"BodySearch\">\r\n        <div className=\"ProductList\">\r\n          {isLoading ? <Loading isLoading={isLoading} />: productFilterPagination.length === 0 ? (\r\n            <div>Không tìm thất kết quả.</div>\r\n          ) : (\r\n            productFilterPagination.map((product, index) => {\r\n              return <CardProduct key={index} itemProduct={product} />;\r\n            })\r\n          )}\r\n        </div>\r\n        {productFilterPagination.length !== 0 && (\r\n          <div className=\"Pagination\">\r\n            <Pagination\r\n              pageChangeClick={getProductListByPagination}\r\n              itemPage={ITEM_PECENT_PAGE}\r\n              totalItem={productFilter.length}\r\n              currentPage={currentPage}\r\n            />\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst getAllCategorySelected = (categoriId, categories) => {\r\n  const category = categories.find((item) => {\r\n    return item.id === categoriId;\r\n  });\r\n  const arrayIdCategory = [];\r\n  if (category) {\r\n    category.subCategory.forEach((item) => {\r\n      const itemMap = item.subCategory.map((itemMap) => {\r\n        return itemMap.id;\r\n      });\r\n      arrayIdCategory.push(...itemMap);\r\n    });\r\n  }\r\n  return arrayIdCategory;\r\n};\r\n\r\nconst getProductList = async (categoryId) => {\r\n  const uri = \"https://api-json-server-290621.herokuapp.com/api/products\";\r\n  const headers = {\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Accept: \"application/json\",\r\n    },\r\n  };\r\n  const url = categoryId !== \"ALL\" ? `${uri}?categoryId=${categoryId}` : uri;\r\n  const response = await fetch(url, headers);\r\n  const responseJson = await response.json();\r\n  return responseJson;\r\n};\r\nexport default ResultSearch;\r\n"]},"metadata":{},"sourceType":"module"}